<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hi Jess</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .fade-out { opacity: 0; transform: scale(0.5); transition: all 1.2s ease; }
    .fade-in { opacity: 1; transform: scale(1); transition: all 1s ease; }
  </style>
</head>
<body class="bg-black text-white flex items-center justify-center min-h-screen">
  <div id="app" class="text-center w-full max-w-xl p-6">
    <h1 id="hiJess" class="text-6xl font-bold mb-4 transition-all duration-1000">Hi Jess</h1>
    <p id="secondMsg" class="text-xl opacity-0 mb-8">I want to make u the happiest woman in the world every day of my life.</p>

    <div id="formSection" class="opacity-0 mt-6 text-left bg-white/5 p-6 rounded">
      <div class="mb-4">
        <label class="block mb-1">Address to deliver the flowers:</label>
        <input id="address" type="text" class="w-full p-2 text-black rounded" placeholder="Dirección...">
      </div>

      <div class="mb-4">
        <label class="block mb-1">Favorite Color?</label>
        <input id="color" type="text" class="w-full p-2 text-black rounded" placeholder="Color favorito...">
      </div>

      <div class="flex gap-3">
        <button id="saveBtn" class="bg-pink-600 px-4 py-2 rounded text-white font-bold">Save Information</button>
        <button id="enterTokenBtn" class="bg-gray-600 px-4 py-2 rounded text-white">Ingresar token / Ver token</button>
        <button id="logoutTokenBtn" class="bg-red-600 px-4 py-2 rounded text-white">Borrar token</button>
      </div>

      <p id="status" class="mt-3 text-sm text-gray-300"></p>
    </div>
  </div>

<script>
  // animación inicial
  setTimeout(() => {
    document.getElementById("hiJess").classList.add("fade-out");
    setTimeout(() => {
      document.getElementById("secondMsg").classList.add("fade-in");
      setTimeout(() => { document.getElementById("formSection").classList.add("fade-in"); }, 1200);
    }, 1200);
  }, 1500);

  // HELPERS
  function getToken() {
    return sessionStorage.getItem("GITHUB_PAT");
  }
  function setToken(t) {
    sessionStorage.setItem("GITHUB_PAT", t);
  }
  function clearToken() {
    sessionStorage.removeItem("GITHUB_PAT");
  }

  // Pide el token al usuario (prompt) y lo guarda en sessionStorage
  document.getElementById("enterTokenBtn").addEventListener("click", () => {
    const existing = getToken();
    const input = prompt("Introduce tu GitHub Personal Access Token (solo se guardará temporalmente en este navegador):", existing ? existing : "");
    if (input !== null) {
      setToken(input.trim());
      document.getElementById("status").innerText = "Token guardado en esta sesión del navegador.";
    }
  });

  document.getElementById("logoutTokenBtn").addEventListener("click", () => {
    clearToken();
    document.getElementById("status").innerText = "Token eliminado de esta sesión.";
  });

  // Función que guarda en GitHub usando la API (PUT a /contents/<path>)
  async function saveToGitHub(address, color) {
    const token = getToken();
    if (!token) {
      alert("Primero debes ingresar tu token (botón 'Ingresar token / Ver token').");
      return;
    }

    // --- CONFIGURA ESTO según tu repo ---
    const owner = "TU_USUARIO_GITHUB";        // reemplaza
    const repo  = "jess-form-data";          // reemplaza si es distinto
    // --- FIN CONFIG ---

    // Construir nombre de archivo con fecha legible
    const now = new Date();
    const timestamp = now.toISOString().replace(/[:.]/g, "-");
    const filename = `data/${timestamp}.txt`;

    const content = `Address: ${address}\nFavorite Color: ${color}\nSaved at: ${now.toLocaleString()}\n`;
    const encoded = btoa(unescape(encodeURIComponent(content))); // base64

    const url = `https://api.github.com/repos/${owner}/${repo}/contents/${filename}`;

    document.getElementById("status").innerText = "Guardando en GitHub...";

    try {
      const response = await fetch(url, {
        method: "PUT",
        headers: {
          "Authorization": `Bearer ${token}`,
          "Content-Type": "application/json",
          "Accept": "application/vnd.github+json"
        },
        body: JSON.stringify({
          message: `Add form data ${timestamp}`,
          content: encoded
        })
      });

      if (!response.ok) {
        const err = await response.json();
        console.error(err);
        document.getElementById("status").innerText = "Error al guardar: " + (err.message || response.status);
        alert("Error al guardar en GitHub. Revisa la consola y el token/permiso.");
        return;
      }

      document.getElementById("status").innerText = "Guardado correctamente en GitHub.";
      alert("Datos guardados correctamente en el repositorio (carpeta data/).");

    } catch (e) {
      console.error(e);
      document.getElementById("status").innerText = "Error de conexión al guardar.";
      alert("Error de conexión: " + e.message);
    }
  }

  // Evento del botón Save
  document.getElementById("saveBtn").addEventListener("click", () => {
    const address = document.getElementById("address").value.trim();
    const color = document.getElementById("color").value.trim();

    if (!address && !color) {
      alert("Por favor completa al menos un campo antes de guardar.");
      return;
    }

    saveToGitHub(address, color);
  });

  // Nota: reemplaza TU_USUARIO_GITHUB y jess-form-data en el código arriba
</script>
</body>
</html>
