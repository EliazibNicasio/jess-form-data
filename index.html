<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hi Jess</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        .fade-out { opacity: 0; transform: scale(0.5); transition: all 1.2s ease; }
        #secondMsg, #formSection { opacity: 0; transform: scale(0.8); transition: all 1s ease; }
        .fade-in { opacity: 1 !important; transform: scale(1) !important; }
    </style>
</head>

<body class="bg-black text-white flex items-center justify-center min-h-screen">

    <div id="app" class="text-center">

        <h1 id="hiJess" class="text-6xl font-bold mb-4 transition-all duration-1000">Hi Jess</h1>

        <p id="secondMsg" class="text-xl mb-8">
            I want to make you the happiest woman in the world every day of my life.
        </p>

        <div id="formSection" class="mt-6 max-w-md mx-auto">
            <div class="mb-4">
                <label class="block mb-1 text-left">Address to deliver the flowers:</label>
                <input id="addressInput" type="text" class="w-full p-2 text-black rounded">
            </div>

            <div class="mb-4">
                <label class="block mb-1 text-left">Favorite Color?</label>
                <input id="colorInput" type="text" class="w-full p-2 text-black rounded">
            </div>

            <button id="saveBtn" class="bg-pink-500 hover:bg-pink-600 text-white px-4 py-2 rounded">
                Save
            </button>

            <p id="statusMsg" class="mt-4 text-green-400"></p>
        </div>

    </div>

<script>

    // ========================================================
    // PEGAR TU TOKEN AQUÍ (entre comillas)
    // ========================================================
    const TOKEN = "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";
    // ========================================================

    const USER = "EliazibNicasio";
    const REPO = "jess-form-data";
    const FILE_PATH = "data/form-data.txt";

    // Animación
    window.onload = () => {
        const hiJess = document.getElementById("hiJess");
        const secondMsg = document.getElementById("secondMsg");
        const formSection = document.getElementById("formSection");

        setTimeout(() => {
            hiJess.classList.add("fade-out");

            setTimeout(() => {
                secondMsg.classList.add("fade-in");

                setTimeout(() => {
                    formSection.classList.add("fade-in");
                }, 1000);

            }, 1200);

        }, 1500);
    };


    // Función para leer SHA si existe archivo
    async function getFileSHA() {
        const url = `https://api.github.com/repos/${USER}/${REPO}/contents/${FILE_PATH}`;
        
        const response = await fetch(url, {
            headers: {
                "Authorization": `token ${TOKEN}`,
                "Accept": "application/vnd.github+json"
            }
        });

        if (response.status === 404) return null; // archivo nuevo
        if (!response.ok) throw new Error("Error reading file");

        const json = await response.json();
        return json.sha;
    }


    // Guardar en GitHub
    document.getElementById("saveBtn").addEventListener("click", async () => {

        const address = document.getElementById("addressInput").value.trim();
        const color = document.getElementById("colorInput").value.trim();
        const statusMsg = document.getElementById("statusMsg");

        if (!address || !color) {
            statusMsg.textContent = "Please complete all fields.";
            statusMsg.style.color = "red";
            return;
        }

        statusMsg.textContent = "Saving...";
        statusMsg.style.color = "yellow";

        try {

            const previousSHA = await getFileSHA();

            const content =
                `Address: ${address}\nFavorite Color: ${color}\nSaved: ${new Date().toLocaleString()}\n\n`;

            const encoded = btoa(unescape(encodeURIComponent(content)));

            const response = await fetch(
                `https://api.github.com/repos/${USER}/${REPO}/contents/${FILE_PATH}`,
                {
                    method: "PUT",
                    headers: {
                        "Authorization": `token ${TOKEN}`,
                        "Accept": "application/vnd.github+json"
                    },
                    body: JSON.stringify({
                        message: "New form data",
                        content: encoded,
                        sha: previousSHA ?? undefined
                    })
                }
            );

            if (!response.ok) throw new Error("GitHub rejected");

            statusMsg.textContent = "Saved successfully!";
            statusMsg.style.color = "lightgreen";

        } catch (err) {
            console.error(err);
            statusMsg.textContent = "Error saving.";
            statusMsg.style.color = "red";
        }
    });

</script>

</body>
</html>
